function setSenderHash(){var e=document.querySelector("#payment-pagseguro"),r=PagSeguroDirectPayment.getSenderHash();if(null==document.querySelector("input[name=sender_hash]")){var t=document.createElement("input");t.setAttribute("name","sender_hash"),t.setAttribute("type","hidden"),t.setAttribute("value",r),e.appendChild(t)}}PagSeguroDirectPayment.setSessionId(document.querySelector("[name='session_id']").value);var items=Payment.getItems(),auth=Payment.getAuth();auth=JSON.parse(auth),items=JSON.parse(items),$.ajax({method:"POST",url:"/pagseguro/generate_order",headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},data:{user_id:auth.id,year:items.year,month:items.month,day:items.day,hour:items.hour,minute:items.minute,second:items.second,package_id:items.package.id},success:function(e){$('[name="order_id"]').val(e.order_id),$('[name="item_id"]').val(e.items.id),$('[name="user_id"]').val(auth.id)},error:function(e){}}),$(function(){function e(){var e={cardNumber:document.getElementById("card_number").value,brand:document.querySelector("input[name=card_brand]").value,cvv:document.querySelector("input[name=card_cvv]").value,expirationMonth:document.querySelector("input[name=card_month]").value,expirationYear:document.querySelector("input[name=card_year]").value,success:function(e){var r=document.querySelector("#payment-pagseguro"),t=JSON.stringify(e.card.token).replace(/"/g,"");if(null==document.querySelector("input[name=card_token]")){var a=document.createElement("input");a.setAttribute("name","card_token"),a.setAttribute("type","hidden"),a.setAttribute("value",t),r.appendChild(a)}else document.querySelector("input[name=card_token]").value=t},error:function(e){window.console.log(e)},complete:function(e){$("body").append(e),setTimeout(function(){r()},3e3)}};PagSeguroDirectPayment.createCardToken(e)}function r(){""==a.val()?swal({title:"Erro nos dados",text:"Revise os dados do cartão e tente novamente.",type:"error",cancelButtonText:"Cancelar",html:!0,showCancelButton:!1,confirmButtonColor:"#00a65a",confirmButtonText:"Tente novamente",closeOnConfirm:!0,showLoaderOnConfirm:!1},function(e){}):$.ajax({method:"POST",async:!1,url:$("#payment-pagseguro").attr("action"),data:$("#payment-pagseguro").serialize(),headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")},beforeSend:function(){$('[type="submit"]').attr("disabled","disabled")},success:function(e){swal({title:"Pedido efeituado",type:"success",text:"Confirme para redirecionar à página do cliente",html:!0,showCancelButton:!1,confirmButtonColor:"#00a65a",confirmButtonText:"Confirmar",closeOnConfirm:!1,showLoaderOnConfirm:!1},function(e){Payment.redirect()})},error:function(e){}})}var t=($('[name="session_id"]').val(),$("#payment-pagseguro")),a=($("#card_number"),$("#card_cvv"),$("#card_year"),$("#card_month"),$('[name="card_token"]'));$(".select2").select2(),$("#card_month").inputmask("99"),$(".card_birth_date").inputmask("99/99/9999"),$("#card_personal_id").inputmask("999.999.999-99"),$("#card_year").inputmask("9999"),$("#cel").inputmask("(99) 99999-9999"),$(".zip").inputmask("99999-999").blur(function(e){var r=$(this).val().replace("-","");$.ajax({method:"GET",url:"https://viacep.com.br/ws/"+r+"/json/",data:{},success:function(e){$('[name="address"]').val(e.logradouro),$('[name="city"]').val(e.localidade),$('[name="state"]').val(e.uf),$('[name="district"]').val(e.bairro)},error:function(e){}})}),$("#card_cvv").inputmask({mask:9,repeat:5,greedy:!1,rightAlign:!1}),$("#card_number").inputmask({mask:9,repeat:20,greedy:!1,rightAlign:!1}),$("#card_number").blur(function(e){var r=$(this).val();""!=r&&PagSeguroDirectPayment.getBrand({cardBin:r.replace(/ /g,""),success:function(e){var r=JSON.stringify(e.brand.name).replace(/"/g,"");if(null==document.querySelector("input[name=card_brand]")){var a=document.createElement("input");a.setAttribute("name","card_brand"),a.setAttribute("type","hidden"),a.setAttribute("value",r),t.append(a)}else document.querySelector("input[name=card_brand]").value=r;$(".fa-credit-card-alt").removeClass("fa-credit-card-alt").addClass("fa-cc-"+r)},error:function(e,r,t){},complete:function(){}})}),$("#payment-pagseguro").on("submit",function(r){r.preventDefault(),document.querySelector('[name="method"]').setAttribute("value","creditCard");var t=$("#payment-pagseguro").valid();$("body").append("isValid "+t),t&&(validateCPF($("#card_personal_id").val())?swal({title:"Deseja continuar?",type:"info",cancelButtonText:"Cancelar",showCancelButton:!0,confirmButtonColor:"#00a65a",confirmButtonText:"Continuar",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(r){e(),setSenderHash()}):swal("Oops...","CPF Inválido!","error"))}),$("#payment-pagseguro").validate({rules:{card_name:{required:!0},card_personal_id:{required:!0},card_birth_date:{required:!0},card_number:{required:!0},card_month:{required:!0,minlength:2,maxlength:2},card_year:{required:!0,minlength:4},card_cvv:{required:!0,minlength:3},number:{required:!0},cel:{required:!0},address:{required:!0},city:{required:!0},district:{required:!0},state:{required:!0},zip:{required:!0}},messages:{card_name:{required:"Campo obrigatório"},card_personal_id:{required:"Campo obrigatório"},card_birth_date:{required:"Campo obrigatório"},card_number:{required:"Campo obrigatório"},card_month:{required:"Campo obrigatório",minlength:"Tamanho mínimo de 2 digitos"},card_year:{required:"Campo obrigatório",minlength:"Tamanho mínimo de 4 digitos"},card_cvv:{required:"Campo obrigatório",minlength:"Tamanho mínimo de 3 digitos"},number:{required:"Campo obrigatório"},cel:{required:"Campo obrigatório"},address:{required:"Campo obrigatório"},city:{required:"Campo obrigatório"},district:{required:"Campo obrigatório"},state:{required:"Campo obrigatório"},zip:{required:"Campo obrigatório"}}})});